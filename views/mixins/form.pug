include links

mixin tools(action, pageName)
  if action == 'edit'
    ul
      if pageName != 'home'
        li
          form(action=`${proxyPath}/pages/${pageName}`, method="post", style="display:inline")
            input(type="hidden", name="_method", value="delete")
            input(type="submit", value="Delete this page").confirm-delete-page.btn.btn-default

  if action == 'show'
    ul
      if !isAnonymous()
        li
          +anchor("/pages/new")(title="Create new page").btn.btn-sm.btn-default
            i.icon.ion-plus-round
      if !isAnonymous() && canEdit
        li
          +anchor("/pages/" + pageName + "/edit")(title="Edit this page").btn.btn-sm.btn-default
            i.icon.ion-compose

      li
        +anchor("/wiki/" + pageName + "/history")(title="Page history").btn.btn-sm.btn-default
          i.icon.ion-clock
      li
        +anchor("/wiki")(title="All pages").btn.btn-sm.btn-default
          i.icon.ion-grid

      if canSearch()
        li
          +anchor("/search")(title="Search through the pages").btn.btn-sm.btn-default
            i.icon.ion-search

  if action == 'history'
    ul
      li
        +anchor("/wiki")(title="All pages").btn.btn-sm.btn-default
          i.icon.ion-grid

mixin saveAndCancel(saveText)
  .well
    input(type='submit',value=saveText || 'Save',title='Save (Ctrl/Cmd+s)').btn.btn-primary
    |&nbsp;
    +anchor("/", "Cancel").btn

mixin errors(err)
  -var errors = locals.errors;
  - if (typeof(errors) != 'undefined' && Object.keys(errors).length > 0)
    .alert.bg-danger
      ul
        each v in errors
          li
            b= v.msg || v

mixin featuresStylesheets()
  case markdownEditor
    when 'codemirror'
      +asset("/css/codemirror-ext.css")(type="text/css")
      +asset("/vendor/codemirror/codemirror.css")(type="text/css")
      +asset("/vendor/codemirror/fullscreen.css")(type="text/css")
    when 'editormd'
      +asset("/editor.md/css/editormd.css")(type="text/css")
      +asset("/editor.md/css/editormd.preview.css")(type="text/css")

mixin featuresJavaScripts()
  case markdownEditor
    when 'codemirror'
      +asset("/vendor/codemirror/codemirror.min.js")
      script.
        Jingo.cmInstance = CodeMirror.fromTextArea(document.getElementById('js--editor'), {
          lineNumbers: true,
          mode: 'gfm',
          matchBrackets: true,
          lineWrapping: true,
          extraKeys: {
            'Ctrl-Enter': function(cm) {
              Jingo.toggleFullscreen();
            },
            'Ctrl-S': function(cm) {
              Jingo.save();
            }
          }
        });
        Jingo.toolbar();
    when 'editormd'
      +asset("/editor.md/editormd.js")
      script.
        $(function() {
          var editor = editormd("editSection", {
            //- autoHeight: true,
            height: 580, // "100%", todo: need modify to fit screen height
            path : "/editor.md/lib/", // Autoload modules mode, codemirror, marked... dependents libs path
            htmlDecode : "style,script,iframe|on*",
            emoji : true,
            taskList : true,
            tocm: true,
            tex: true,
            flowChart : true,
            sequenceDiagram : true,
            imageUpload : true,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL : "/uploadRouter",
            onload : function() {
              console.log('onload', this);
              //this.fullscreen();
              //this.unwatch();
              //this.watch().fullscreen();

              //this.setMarkdown("#PHP");
              //this.width("100%");
              //this.height(480);
              //this.resize("100%", 640);
            }
          });
          //- console.error('editor', editor)
        });

mixin warning()
  -var warning = locals.warning;
  - if (typeof(warning) != 'undefined')
    .alert.alert-block.alert-warning !{warning}

mixin notice()
  -var notice = locals.notice;
  - if (typeof(notice) != 'undefined')
    .alert.alert-block.alert-info.alert-dismissible !{notice}

mixin dialogBox(h)
  .modal-dialog
    .modal-content
      .modal-header
        button(data-dismiss="modal", aria-hidden="true").close &times;
        h3 #{h}
      .modal-body
      .modal-footer
